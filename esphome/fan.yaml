substitutions:
  name: "fan"
  ap_ssid: "Desk Control Fallback Hotspot"

esphome:
  <<: !include .board-config.yaml
  # Fix for low output signal on transmit gpio on boot
  # on_boot:
    # then:
      # - remote_transmitter.transmit_raw:
          # code: [-10]

<<: !include .base-config.yaml

# deep_sleep:
#   run_duration: 10s
#   sleep_duration: 60s
#   wakeup_pin: 33

### Receive and Transmit IR
remote_receiver:
  pin:
    number: 32
    # inverted: true
    #mode: INPUT_PULLDOWN
  # Use raw not all, otherwise it gets detected as a rc_switch
  # code but transmitting that will produce the wrong code.
  # Just press the buttons very shortly while right in front
  # of the receive to get the shortest yet most accurate result.
  dump: raw

remote_transmitter:
  pin:
    number: 33
    inverted: true
  carrier_duty_percent: 50%

switch:
  - platform: template
    name: "On/Fan Speed"
    id: on_fan_speed
    icon: mdi:fan
    turn_on_action:
      - remote_transmitter.transmit_raw:
          # Just read inverted raw value with remote_receiver, however to remote_transmitter ouput pin must be set to inverted.
          code: [-1319, 368, -1317, 369, -472, 1193, -1317, 369, -1315, 371, -471, 1192, -471, 1195, -471, 1194, -471, 1194, -471, 1194, -1315, 373, -467, 7546, -1313, 373, -1289, 397, -444, 1221, -1289, 397, -1288, 399, -441, 1222, -444, 1222, -442, 1224, -441, 1223, -443, 1223, -1286, 401, -439, 7115, -1284, 402, -1238, 448, -394, 1269, -1241, 447, -1239, 447, -393, 1272, -394, 1270, -396, 1269, -395, 1270, -396, 1269, -1240, 447, -395, 7617, -1240, 447, -1239, 447, -393, 1272, -1272, 414, -1272, 413, -428, 1236, -428, 1237, -429, 1237, -427, 1237, -429, 1236, -1274, 413, -427]
      - delay: 1ms
      - switch.turn_off: on_fan_speed

  - platform: template
    name: "Mode"
    id: mode
    turn_on_action:
      remote_transmitter.transmit_raw:
        code: [-1318, 368, -1318, 368, -473, 1191, -1318, 368, -1317, 369, -471, 1192, -473, 1193, -472, 1193, -472, 1192, -1316, 372, -470, 1194, -469, 7544, -1315, 372, -1313, 374, -460, 1203, -1289, 397, -1289, 397, -443, 1222, -443, 1221, -444, 1221, -444, 1223, -1287, 399, -441, 1223, -442, 7110, -1284, 403, -1238, 447, -394, 1271, -1240, 446, -1239, 447, -394, 1270, -395, 1270, -396, 1269, -396, 1270, -1240, 447, -393, 1270, -396, 7620, -1239, 447, -1238, 448, -394, 1269, -1240, 447, -1271, 414, -396, 1269, -428, 1237, -428, 1237, -429, 1236, -1274, 414, -426, 1238, -428]
      - delay: 1ms
      - switch.turn_off: mode

  - platform: template
    name: "Swing"
    id: swing
    icon: mdi:cached
    turn_on_action:
      remote_transmitter.transmit_raw:
        code: [-1318, 367, -1318, 369, -472, 1190, -1320, 368, -1317, 368, -473, 1192, -472, 1193, -1316, 370, -472, 1193, -471, 1193, -473, 1193, -473, 7542, -1317, 370, -1315, 371, -470, 1195, -1312, 374, -1288, 397, -445, 1220, -469, 1196, -1289, 399, -442, 1221, -445, 1221, -443, 1223, -443, 7109, -1287, 401, -1285, 400, -439, 1224, -1286, 401, -1239, 447, -393, 1272, -394, 1270, -1240, 448, -392, 1271, -395, 1270, -396, 1269, -395, 7620, -1240, 447, -1239, 446, -394, 1270, -1241, 447, -1239, 447, -395, 1269, -395, 1269, -1272, 416, -426, 1238, -427, 1238, -428, 1237, -428]
      - delay: 1ms
      - switch.turn_off: swing

  - platform: template
    name: "Mist"
    id: mist
    turn_on_action:
      remote_transmitter.transmit_raw:
        code: [-1320, 367, -1316, 369, -473, 1191, -1317, 369, -1317, 369, -1316, 370, -470, 1195, -470, 1193, -472, 1194, -471, 1194, -1315, 372, -1314, 6680, -1314, 373, -1287, 398, -444, 1220, -1289, 397, -1286, 400, -1287, 398, -442, 1223, -442, 1222, -442, 1223, -440, 1225, -1286, 401, -1238, 6292, -1283, 404, -1239, 447, -393, 1271, -1239, 448, -1236, 449, -1237, 448, -393, 1270, -395, 1270, -396, 1269, -396, 1269, -1240, 446, -1238, 6755, -1272, 414, -1271, 414, -426, 1237, -1273, 413, -1273, 412, -1241, 444, -396, 1268, -396, 1269, -397, 1269, -395, 1269, -1240, 446, -1239]
      - delay: 1ms
      - switch.turn_off: mist

  - platform: template
    name: "Off"
    id: "off"
    turn_on_action:
      remote_transmitter.transmit_raw:
        code: [-1317, 369, -1316, 369, -471, 1194, -1316, 370, -1315, 370, -469, 1195, -469, 1197, -469, 1194, -471, 1195, -470, 1196, -468, 1195, -1290, 6745, -1289, 398, -1286, 399, -444, 1221, -1288, 398, -1287, 399, -442, 1223, -441, 1223, -441, 1225, -440, 1225, -440, 1225, -438, 1226, -1240, 6337, -1239, 448, -1239, 446, -394, 1271, -1239, 448, -1237, 448, -393, 1270, -396, 1270, -395, 1270, -394, 1271, -395, 1271, -394, 1271, -1240, 6795, -1272, 414, -1272, 413, -428, 1237, -1274, 413, -1271, 414, -427, 1238, -427, 1237, -428, 1237, -428, 1237, -429, 1237, -427, 1237, -1273]
      - delay: 1ms
      - switch.turn_off: "off"

### Status
binary_sensor:
  - platform: gpio
    pin: 25
    name: "On"
    device_class: power
