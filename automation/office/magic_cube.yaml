- id: magic_cube
  alias: Office Magic Cube Automations
  description: ''
  mode: restart
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: office_magic_cube
  condition: []
  # - condition: template
  #   value_template: |
  #     {% set event = trigger.event.data.event | int %}
  #     {{
  #       event == 1002 or event == 1004 or
  #       event == 2002 or event == 2004 or
  #       event == 3002 or event == 3004 or
  #       event == 4002 or event == 4004
  #     }}
  action:
  - service: persistent_notification.create
    data:
      title: '{{ trigger.event.data.gesture }}'
      message: '{{ trigger.event.data }}'

  - choose:
    # GESTURE_SHAKE light on/off
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.gesture | int == 1 }}'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: light.office_led
            state: 'on'
          sequence:
          - service: light.turn_off
            target:
              entity_id: light.office_led
        default:
        - service: scene.turn_on
          target:
            entity_id: scene.office_work_light

    # GESTURE_FLIP_180 desk up/down
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.gesture | int == 4 }}'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 1006 }}'
          sequence:
          - service: switch.turn_off
            target:
              entity_id:
                - switch.desk_control_button_4
                - switch.desk_control_button_up
                - switch.desk_control_button_down
          - delay:
              milliseconds: 250
          - service: switch.turn_on
            target:
              entity_id: switch.desk_control_button_1

        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 6001 }}'
          sequence:
          - service: switch.turn_off
            target:
              entity_id:
                - switch.desk_control_button_1
                - switch.desk_control_button_up
                - switch.desk_control_button_down
          - delay:
              milliseconds: 250
          - service: switch.turn_on
            target:
              entity_id: switch.desk_control_button_4
        default: []

    # GESTURE_FLIP_90 shutters
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.gesture | int == 3 }}'
      - condition: state
        entity_id: binary_sensor.cover_operation_to_cold
        state: 'off'
      sequence:
      - choose:
        - conditions:
          # Left shutter automations
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 2001 }}'
          sequence:
          - service: cover.close_cover
            target:
              entity_id: cover.office_roller_shutter_left_level

        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 1002 or trigger.event.data.event | int == 1005 }}'
          sequence:
          - service: cover.stop_cover
            target:
              entity_id: cover.office_roller_shutter_left_level

        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 5001 }}'
          sequence:
          - service: cover.open_cover
            target:
              entity_id: cover.office_roller_shutter_left_level

        # Right shutter automations
        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 3001 }}'
          sequence:
          - service: cover.close_cover
            target:
              entity_id: cover.office_roller_shutter_right_level

        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 1003 or trigger.event.data.event | int == 1004 }}'
          sequence:
          - service: cover.stop_cover
            target:
              entity_id: cover.office_roller_shutter_right_level

        - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.event | int == 4001 }}'
          sequence:
          - service: cover.open_cover
            target:
              entity_id: cover.office_roller_shutter_right_level

    default: []


# GESTURE_NONE                     0
# GESTURE_SHAKE                    1
# GESTURE_DROP                     2
# GESTURE_FLIP_90                  3
# GESTURE_FLIP_180                 4
# GESTURE_PUSH                     5
# GESTURE_DOUBLE_TAP               6
# GESTURE_ROTATE_CLOCKWISE         7
# GESTURE_ROTATE_COUNTER_CLOCKWISE 8
