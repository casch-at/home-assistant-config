- id: low_illuminance
  alias: Low illuminance light
  description: Turn on lights when the sun goes down or on low light condition
  mode: single
  max_exceeded: silent
  trigger:
  - platform: numeric_state
    entity_id: sensor.front_floor_lightlevel
    below: 100
    for:
      minutes: 5

  - platform: state
    entity_id: person.christian_schwarzgruber
    from: not_home
    to: home

  - platform: state
    entity_id: person.sonia_avramidis
    from: not_home
    to: home
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.christian_schwarzgruber
      state: home
    - condition: state
      entity_id: person.sonia_avramidis
      state: home

  - condition: numeric_state
    entity_id: sensor.front_floor_lightlevel
    below: 100

  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.daytime
      state: Night
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.stairs_led
        state: 'off'
      sequence:
      - service: light.turn_on
        data:
          brightness: 180
          color_temp: 375
        target:
          entity_id: light.stairs_led
    default: []

  - choose:
    - conditions:
      - condition: state
        entity_id: light.parlor_shelve
        state: 'off'
      - condition: state
        entity_id: person.sonia_avramidis
        state: home
      sequence:
      - service: light.turn_on
        data:
          brightness: 100
          color_temp: 370
        target:
          entity_id: light.parlor_shelve
    default: []

  - choose:
    - conditions:
      - condition: state
        entity_id: light.parlor_plants
        state: 'off'
      - condition: state
        entity_id: person.sonia_avramidis
        state: home
      sequence:
      - service: scene.apply
        data:
          entities:
            light.parlor_plants:
              brightness: 170
              hs_color:
              - 75.818
              - 43.137
              rgb_color:
              - 200
              - 255
              - 145
              xy_color:
              - 0.361
              - 0.459
              state: 'on'
    default: []

  - choose:
    - conditions:
      - condition: state
        entity_id: light.office_led
        state: 'off'
      - condition: state
        entity_id: switch.desk_switch
        state: 'on'
      sequence:
      - service: scene.turn_on
        data:
          entity_id: scene.office_work_light
    default: []
