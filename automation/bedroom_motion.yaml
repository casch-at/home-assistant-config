- id: bedroom_motion
  alias: Bedroom Motion
  description: ''
  mode: single
  trigger:
  - platform: state
    entity_id: binary_sensor.bedroom_motion
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_select.daytime
    state: 'Night'

  - condition: state
    entity_id: light.stairs_led
    state: 'off'

  - condition: state
    entity_id: input_boolean.presence
    state: 'on'
  action:
  - service: scene.turn_on
    data:
      entity_id: scene.night_toilet_light

  - delay: 00:00:30

  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: light.stairs_led
          state: 'on'
        - condition: template
          value_template: >-
            {{
              state_attr('light.stairs_led', 'brightness') and
              state_attr('light.stairs_led', 'brightness') <= 14 and
              state_attr('light.stairs_led', 'color_temp') and
              state_attr('light.stairs_led', 'color_temp') == 495
            }}
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.stairs_led
        data:
          brightness_pct: 3
      - delay: 00:00:30
    default: []

  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: light.stairs_led
          state: 'on'
        - condition: template
          value_template: >-
            {{
              state_attr('light.stairs_led', 'brightness') and
              state_attr('light.stairs_led', 'brightness') <= 8 and
              state_attr('light.stairs_led', 'color_temp') and
              state_attr('light.stairs_led', 'color_temp') == 495
            }}
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.stairs_led
        data:
          brightness_pct: 2
      - delay: 00:01:00
    default: []

  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: light.stairs_led
          state: 'on'
        - condition: template
          value_template: >-
            {{
              state_attr('light.stairs_led', 'brightness') and
              state_attr('light.stairs_led', 'brightness') <= 6 and
              state_attr('light.stairs_led', 'color_temp') and
              state_attr('light.stairs_led', 'color_temp') == 495
            }}
      sequence:
      - service: light.turn_on
        target:
          entity_id: light.stairs_led
        data:
          brightness_pct: 1
      - delay: 00:01:00
    default: []

  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: light.stairs_led
          state: 'on'
        - condition: template
          value_template: >-
            {{
              state_attr('light.stairs_led', 'brightness') and
              state_attr('light.stairs_led', 'brightness') <= 3 and
              state_attr('light.stairs_led', 'color_temp') and
              state_attr('light.stairs_led', 'color_temp') == 495
            }}
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.stairs_led
    default: []
