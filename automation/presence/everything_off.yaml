- id: presence_everything_off
  alias: Turn everything off on presence state off
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.presence
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.front_floor_switch_active
        state: 'on'
      sequence:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.front_floor_switch_active
    default: []
  - service: script.reset_lower_kitchen_switch_active_states
  - service: homeassistant.turn_off
    data:
      entity_id: group.all_lights_extra
  - service: homeassistant.turn_off
    data:
      entity_id: group.devices
  - delay: 00:00:05
  - choose:
    - conditions:
      - condition: template
        value_template: >-
          {{
          states('device_tracker.lap_02_lan_router') == 'not_home' and
          states('device_tracker.lap_02_wlan_router') == 'not_home' and
          states('device_tracker.work_wlan_router') == 'not_home'
          }}
      sequence:
      - service: homeassistant.turn_off
        data:
          entity_id: group.desk_and_laptop
    default: []
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''device_tracker.tower_lan_router'') == ''not_home'' }}'
      sequence:
      - service: switch.turn_off
        data:
          entity_id: switch.tower
    default: []
  - service: switch.turn_off
    data:
      entity_id:
        - switch.printer
        - switch.tv_switch
        - switch.tv_usb
        - switch.nightstand_usb
  mode: single
