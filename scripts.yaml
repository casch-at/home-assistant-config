kitchen_cabinet_light_based_on_entity_state:
  alias: Kitchen Cabinet Light Based On Entity State
  mode: queued
  max: 10
  icon: mdi:file-cabinet
  sequence:
  - service: scene.create
    data:
      scene_id: kitchen_cabinet_light_based_on_entity_state_kitchen_cabinet_backup
      snapshot_entities:
      - light.kitchen_cabinet_light
  - service: light.turn_on
    data:
      rgb_color: "{% if states(entity_id) == 'off' -%}\n  [50, 200, 0]\n{% else -%}\n
        \ [200, 50, 0]\n{% endif %}"
      brightness: 150
      transition: 1
    target:
      entity_id: light.kitchen_cabinet_light
  - delay: 00:00:01
  - service: scene.turn_on
    target:
      entity_id: scene.kitchen_cabinet_light_based_on_entity_state_kitchen_cabinet_backup
    data: {}
office_on_off:
  alias: Office On Off
  mode: single
  icon: mdi:office-building
  sequence:
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: light.office_lights
        state: 'off'
      - condition: state
        entity_id: switch.desk_switch
        state: 'off'
    then:
    - service: light.turn_on
      target:
        entity_id: light.office_lights
    - service: switch.turn_on
      target:
        entity_id: switch.desk_switch
    else:
    - service: light.turn_off
      data:
        transition: 10
      target:
        entity_id: light.office_lights
    - service: switch.turn_off
      target:
        entity_id: switch.desk_switch
shutters_down_sun:
  alias: Shutters Down Sun
  mode: single
  icon: hass:window-closed
  sequence:
  - condition: state
    entity_id: binary_sensor.shutter_operation_to_cold_or_windy
    state: 'off'
  - if:
    - condition: state
      entity_id: binary_sensor.office_window_sensor
      state: 'off'
    then:
    - service: cover.close_cover
      target:
        area_id: office
  - if:
    - condition: state
      entity_id: binary_sensor.parlor_window_sensor
      state: 'off'
    then:
    - service: cover.close_cover
      target:
        area_id: parlor
  - if:
    - condition: state
      entity_id: binary_sensor.lower_kitchen_window_sensor
      state: 'off'
    then:
    - service: cover.close_cover
      target:
        entity_id: cover.lower_kitchen_roller_shutter_left_level
  - if:
    - condition: state
      entity_id: binary_sensor.upstairs_window_sensor
      state: 'off'
    then:
    - service: cover.close_cover
      target:
        area_id: upstairs
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: cover.stop_cover
    target:
      area_id:
      - office
      - parlor
      - upstairs
      entity_id: cover.lower_kitchen_roller_shutter_left_level
shutters_up_sun:
  alias: Shutters Up Sun
  mode: single
  icon: hass:window-open
  sequence:
  - condition: state
    entity_id: binary_sensor.shutter_operation_to_cold_or_windy
    state: 'off'
  - if:
    - condition: state
      entity_id: binary_sensor.office_window_sensor
      state: 'off'
    then:
    - service: cover.open_cover
      target:
        area_id: office
  - if:
    - condition: state
      entity_id: binary_sensor.parlor_window_sensor
      state: 'off'
    then:
    - service: cover.open_cover
      target:
        area_id: parlor
  - if:
    - condition: state
      entity_id: binary_sensor.lower_kitchen_window_sensor
      state: 'off'
    then:
    - service: cover.open_cover
      target:
        entity_id: cover.lower_kitchen_roller_shutter_left_level
  - if:
    - condition: state
      entity_id: binary_sensor.upstairs_window_sensor
      state: 'off'
    then:
    - service: cover.open_cover
      target:
        area_id: upstairs
night_light:
  alias: Night Light
  sequence:
  - service: scene.turn_on
    data: {}
    target:
      entity_id:
      - scene.floor_front_night
      - scene.office_desk_night
      - scene.kitchen_cabinet_night
  - service: script.scene_on
    data:
      scene: scene.bedroom_bed_night
      light:
      - light.bedroom_bed_light
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id:
      - input_boolean.floor_light_active
      - input_boolean.floor_helper_light_active
    enabled: true
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.floor_middle_light
      - light.floor_back_light
  mode: single
  icon: mdi:lightbulb-night
scene_on:
  alias: Scene On
  fields:
    scene:
      name: Scene Entity
      description: Scene to turn on (Without the "scene." prefix)
      required: true
      selector:
        entity:
          domain: scene
    light:
      name: Light Entity
      required: true
      selector:
        entity:
          domain: light
          multiple: true
  mode: queued
  max: 10
  icon: mdi:light-flood-down
  sequence:
  - service: light.turn_off
    target:
      entity_id: "{{ \n  light | \n  default(scene | \n    regex_replace(find='^scene',
        replace='light') | \n    regex_replace(find='[a-z]+$', replace='light')\n
        \ ) \n}}"
    data: {}
  - service: scene.turn_on
    target:
      entity_id: '{{ scene }}'
shutter_horizontal_open:
  alias: Shutter Horizontal Open
  fields:
    area:
      name: Area name
      description: Close shutter but open them horizontally at the end (parlor/bedroom)
      required: true
      selector:
        entity:
          domain: switch
  sequence:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.{{ area }}_shutter_down_relay
  - delay:
      hours: 0
      minutes: 0
      seconds: '{{ states(''input_number.'' + area + ''_shutter_horizontal_open_delay'')
        | int(0) }}'
      milliseconds: 0
  - wait_template: '{{ states(''sensor.'' + area + ''_shutter_down_energy_power'')
      | float(0) < 2.0 }}'
    continue_on_timeout: false
    timeout: 00:01:30
    enabled: false
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.{{ area }}_shutter_up_relay
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 100
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.{{ area }}_shutter_up_relay
  mode: single
  icon: mdi:blinds-horizontal
